<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rainwater Trapping Visualizer — Vanilla JS</title>
  <style>
    :root{
      --bg:#0b0c10;            /* page bg */
      --panel:#11131a;         /* card bg */
      --muted:#a7b0c0;         /* secondary text */
      --text:#f2f5f7;          /* primary text */
      --accent:#5b9bff;        /* water */
      --block:#ffd84d;         /* blocks */
      --grid:#2a2e3a;          /* grid lines */
      --ok:#76e3a2;            /* success */
      --err:#ff7b7b;           /* error */
      --radius:16px;
    }
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background:radial-gradient(1200px 800px at 10% -10%, #151826, #0b0c10 60%);
    }
    .wrap{max-width:1100px; margin:32px auto; padding:0 16px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px}
    h1{font-size:clamp(20px, 3vw, 28px); margin:0}
    .card{background:var(--panel); border:1px solid #1b2030; border-radius:var(--radius); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .controls{padding:18px; display:grid; grid-template-columns:1fr; gap:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    label{font-weight:600}
    input[type=text]{
      flex:1 1 520px; min-width:260px;
      background:#0e111a; color:var(--text); border:1px solid #23283a; border-radius:12px; padding:12px 14px; outline:none;
    }
    input[type=text]::placeholder{color:#7d87a1}
    .btn{appearance:none; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; background:#1f5eff; color:white}
    .btn.secondary{background:#212636; color:#d7deea; border:1px solid #2a3042}
    .btn.ghost{background:transparent; border:1px dashed #2a3042; color:#c9d1e3}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .meta{display:flex; gap:18px; align-items:center; flex-wrap:wrap}
    .pill{font-weight:700; font-size:14px; background:#111523; border:1px solid #23283a; padding:8px 10px; border-radius:999px}
    .pill.ok{border-color:#1e3b2e; background:#0d2016; color:var(--ok)}
    .pill.err{border-color:#3b1e1e; background:#201010; color:var(--err)}

    .canvas-card{margin-top:16px}
    .canvas-head{display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid #1b2030}
    .legend{display:flex; gap:16px; align-items:center}
    .legend .key{display:inline-flex; align-items:center; gap:6px}
    .swatch{width:18px; height:14px; border-radius:3px; background:var(--accent); outline:1px solid #1b2030}
    .swatch.block{background:var(--block)}
    .canvas-wrap{position:relative; padding:18px; overflow:auto}
    canvas{background:#0b0f18; border-radius:12px; display:block; outline:1px solid #1b2030; margin-inline:auto}
    .help{color:var(--muted); font-size:14px}
    footer{opacity:.75; margin-top:16px; text-align:center; color:#a3acc4}

    @media (min-width:860px){
      .controls{grid-template-columns:1fr auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Rainwater Trapping Visualizer (Vanilla JS)</h1>
      <div class="help">Type heights, hit <strong>Compute</strong>, see blocks (yellow) and water (blue).</div>
    </header>

    <section class="card controls" role="form" aria-label="Input Controls">
      <div class="row" style="gap:12px">
        <label for="heights" class="vis">Heights</label>
        <input id="heights" type="text" inputmode="numeric" placeholder="e.g. [0,4,0,0,0,6,0,6,4,0]" value="[0,4,0,0,0,6,0,6,4,0]">
        <button id="compute" class="btn" title="Compute trapped water">Compute</button>
        <button id="random" class="btn secondary" title="Random heights">Randomize</button>
        <button id="animate" class="btn ghost" title="Animate water fill">Animate</button>
      </div>
      <div class="meta" id="meta">
        <div class="pill" id="size-pill">Array size: —</div>
        <div class="pill ok" id="units-pill">Water: — units</div>
        <div class="pill" id="max-pill">Max stack height: —</div>
        <div class="pill err" id="error-pill" hidden>—</div>
      </div>
    </section>

    <section class="card canvas-card">
      <div class="canvas-head">
        <div class="legend">
          <span class="key"><span class="swatch"></span> Water</span>
          <span class="key"><span class="swatch block"></span> Block</span>
        </div>
        <div class="help">Grid cell = 1 unit</div>
      </div>
      <div class="canvas-wrap">
        <canvas id="viz" width="800" height="420" aria-label="Visualization Canvas"></canvas>
      </div>
    </section>

    <footer>Made with plain HTML/CSS/JS • O(n) / O(1) two‑pointer algorithm</footer>
  </div>

  <script>
    // --- Utilities ---------------------------------------------------------
    const $ = sel => document.querySelector(sel);
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

    function parseHeights(raw){
      if(!raw) throw new Error("Please enter some numbers.");
      const cleaned = raw.replace(/[\[\]]/g, "").trim();
      if(cleaned === "") throw new Error("Please enter some numbers.");
      const arr = cleaned.split(/[,\s]+/).filter(Boolean).map(Number);
      if(arr.some(n => !Number.isFinite(n))) throw new Error("Only integers separated by comma/space are allowed.");
      if(arr.some(n => n < 0)) throw new Error("Heights must be non‑negative.");
      return arr.map(n => Math.floor(n)); // normalize to integers
    }

    // Two-pointer O(n) time / O(1) extra space; also returns per-column water
    function trapWater(heights){
      const n = heights.length;
      let l = 0, r = n - 1, lMax = 0, rMax = 0, total = 0;
      const water = new Array(n).fill(0);
      while(l <= r){
        if(heights[l] <= heights[r]){
          lMax = Math.max(lMax, heights[l]);
          const w = Math.max(0, lMax - heights[l]);
          water[l] = w; total += w; l++;
        }else{
          rMax = Math.max(rMax, heights[r]);
          const w = Math.max(0, rMax - heights[r]);
          water[r] = w; total += w; r--;
        }
      }
      const stack = heights.map((h,i)=>h+water[i]);
      const rows = Math.max(1, ...stack);
      return { total, water, rows };
    }

    // Responsive cell size based on container width
    function calcCellSize(cols){
      const padding = 36; // left+right in .canvas-wrap
      const wrap = document.querySelector('.canvas-wrap');
      const maxW = wrap.clientWidth - padding;
      // prefer larger cells but clamp for big arrays
      return clamp(Math.floor(maxW / cols), 18, 44);
    }

    // Draw grid, blocks, and water on a canvas
    function draw(heights, water, rows, opts={}){
      const canvas = $('#viz');
      const ctx = canvas.getContext('2d');
      const cols = heights.length;
      const cell = calcCellSize(cols);
      const width = cols * cell, height = rows * cell;
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.max(320, Math.round(width * dpr));
      canvas.height = Math.max(160, Math.round(height * dpr));
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--grid').trim();
      // draw grid lines
      ctx.strokeStyle = gridColor; ctx.lineWidth = 1;
      for(let c=0;c<=cols;c++){ ctx.beginPath(); ctx.moveTo(0.5 + c*cell, 0); ctx.lineTo(0.5 + c*cell, height); ctx.stroke(); }
      for(let r=0;r<=rows;r++){ ctx.beginPath(); ctx.moveTo(0, 0.5 + r*cell); ctx.lineTo(width, 0.5 + r*cell); ctx.stroke(); }

      // helpers to plot from bottom
      const yAt = (level)=> height - (level+1)*cell;

      // draw blocks (yellow)
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--block').trim();
      for(let i=0;i<cols;i++){
        for(let k=0;k<heights[i];k++){
          ctx.fillRect(i*cell+1, yAt(k)+1, cell-1, cell-1);
        }
      }

      // draw water (blue) - optionally animate with progress 0..1
      const progress = typeof opts.progress === 'number' ? clamp(opts.progress, 0, 1) : 1;
      const eased = 1 - Math.pow(1-progress, 2); // easeOutQuad
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
      for(let i=0;i<cols;i++){
        const w = Math.floor(water[i] * eased);
        for(let k=0;k<w;k++){
          ctx.fillRect(i*cell+1, yAt(heights[i] + k)+1, cell-1, cell-1);
        }
      }
    }

    // UI wiring -------------------------------------------------------------
    const input = $('#heights');
    const btnCompute = $('#compute');
    const btnRandom = $('#random');
    const btnAnimate = $('#animate');

    const sizeP = $('#size-pill');
    const unitsP = $('#units-pill');
    const maxP = $('#max-pill');
    const errP = $('#error-pill');

    let state = { heights: [], result: null };

    function updateMeta(){
      if(!state.result){
        sizeP.textContent = 'Array size: —';
        unitsP.textContent = 'Water: — units';
        maxP.textContent = 'Max stack height: —';
        return;
      }
      sizeP.textContent = `Array size: ${state.heights.length}`;
      unitsP.textContent = `Water: ${state.result.total} unit${state.result.total===1?'':'s'}`;
      maxP.textContent = `Max stack height: ${state.result.rows}`;
    }

    function computeAndRender(){
      try{
        errP.hidden = true;
        const heights = parseHeights(input.value);
        const {total, water, rows} = trapWater(heights);
        state = { heights, result:{ total, water, rows } };
        draw(heights, water, rows);
        updateMeta();
      }catch(err){
        errP.textContent = err.message; errP.hidden = false;
      }
    }

    function randomize(){
      const len = Math.floor(Math.random()*10)+8; // 8..17
      const maxH = Math.floor(Math.random()*6)+4; // 4..9
      const arr = Array.from({length:len},()=> Math.floor(Math.random()*(maxH+1)));
      input.value = `[${arr.join(',')}]`;
      computeAndRender();
    }

    let rafId = null; let animStart = 0;
    function animate(){
      if(!state.result){ computeAndRender(); }
      cancelAnimationFrame(rafId); animStart = performance.now();
      const step = (t)=>{
        const p = clamp((t-animStart)/1200, 0, 1); // 1.2s
        draw(state.heights, state.result.water, state.result.rows, {progress:p});
        if(p<1) rafId = requestAnimationFrame(step);
      };
      rafId = requestAnimationFrame(step);
    }

    // Events
    btnCompute.addEventListener('click', computeAndRender);
    btnRandom.addEventListener('click', randomize);
    btnAnimate.addEventListener('click', animate);

    window.addEventListener('resize', ()=>{ if(state.result){ draw(state.heights, state.result.water, state.result.rows); }});

    // Initial render with the placeholder sample
    computeAndRender();

    // Allow Enter key to trigger compute
    input.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && (e.metaKey||e.ctrlKey||!e.shiftKey)) { e.preventDefault(); computeAndRender(); }});
  </script>
</body>
</html>
